doctype html
html(lang="ru", ng-app='adminModule')
    head
        title= "Masons mafia admin"
        meta(charset='utf-8', name='viewport', content='width=device-width, initial-scale=1.0')
        link(rel='stylesheet', href='/css/bootstrap.min.css')
        link(rel='stylesheet', href='/css/font-awesome.min.css')
        link(rel='stylesheet', href='/css/app.css')
        script(src='/js/jquery.min.js', type='text/javascript')
        script(src='/js/bootstrap.min.js', type='text/javascript')
        script(src='/js/moment.min.js', type='text/javascript')
        script(src='/js/angular.min.js', type='text/javascript')
        script(src='/js/angular-locale_ru-ru.js', type='text/javascript')
        script(src='/js/ui-bootstrap-tpls.min.js', type='text/javascript')
        script(src='/js/typeahead.bundle.min.js', type='text/javascript')
        script(src='/js/app_admin.js', type='text/javascript')
    body
        include navigation
        div.container
            div.col-sm-1
            div.col-sm-9
                form.form-horizontal(name='gameResultForm', ng-controller="formCtrl", novalidate,ng-submit="submit()")
                    div.row
                        div.col-sm-4(ng-controller='datePickerCtrl')
                            label(for='date') Дата:
                            div#datepicker.input-group.date(ng-class="{'has-error': gameResultForm.datePicker.$invalid}")
                                input#date.form-control(type='text', name='datePicker', ng-click="open($event)", ng-model='dt.value', required, datepicker-popup='dd-MMMM-yyyy', is-open="opened", ng-required="true", close-on-date-selection='false', current-text='Сегодня', clear-text='Очистить', close-text='Закрыть', placeholder='Введите дату..', tabindex='1')
                                span.input-group-btn
                                    button.btn.btn-default.form-control(type='button', ng-click="open($event)")
                                        i.fa.fa-th

                        div.col-sm-4(ng-controller='refereeSelectCtrl', ng-class="{'has-error': gameResultForm.refereeName.$dirty && gameResultForm.refereeName.$invalid}")
                            label(for='date') Ведущий:
                            input.form-control.player-name(type='text', name="refereeName", ng-model='referee.value', typeahead='name for name in names|filter:$viewValue', required, placeholder='Введите имя..', tabindex='2')

                        div.col-sm-4(ng-controller='winPartyCtrl')
                            label(for='winParty') Победа:
                            select#winParty.form-control(ng-init='winningParties=["Мирные", "Мафия"]', ng-model="winningParty.value", ng-options='party for party in winningParties', tabindex='3')

                    div.row
                        div.col-sm-3
                            span
                                br
                    div.row
                        div.col-sm-12(ng-controller='playersTableCtrl')
                            label(for='players-table') Игроки:
                            table#players-table.table.table-striped.table-bordered.table-responsive
                                thead
                                    tr
                                        th #
                                        th Имя
                                        th Роль
                                        th Фолов
                                        th Лайки
                                        th Лучший игрок
                                        th Доп. Очки
                                tbody
                                    tr(ng-repeat='player in players')
                                        td.idx {{$index+1}}
                                        td.col-xs-4
                                            ng-form(name='playerNameForm', novalidate)
                                                div(ng-class="{'has-error': playerNameForm.playerName.$dirty && playerNameForm.playerName.$invalid}")
                                                    input.form-control.player-name(name='playerName', ng-model='player.name', type='text', typeahead='name for name in names | filter:$viewValue', required, placeholder='Введите имя..')
                                        td.col-xs-2
                                            select.form-control(ng-model='player.role', ng-options='role for role in roles')
                                        td.col-xs-2
                                            select.form-control(ng-init='possibleFouls=[0, 1, 2, 3, 4]', ng-model='player.fouls', ng-options='possibleFoul for possibleFoul in possibleFouls')
                                        td.col-xs-2
                                            ng-form(name='likesNumberForm', novalidate)
                                                div(ng-class="{'has-error': likesNumberForm.likesNumber.$invalid}")
                                                    input.form-control(ng-model='player.likes', name='likesNumber', type='number', required, min='0', placeholder='Введите количество..')
                                        td.col-xs-1.is-best.text-center
                                            input(ng-model='player.isBest', type='checkbox')
                                        td.col-xs-1
                                            ng-form(name='extraScoresForm', novalidate)
                                                div(ng-class="{'has-error': extraScoresForm.extraScoresField.$invalid}")
                                                    input.form-control(ng-model='player.extraScores', name='extraScoresField', type='text', smart-float, required, placeholder='Дополнительные очки..')
                    div.row
                        label.col-sm-3 Первый отстреленный игрок:
                        div.col-sm-3
                            input.form-control.player-name(ng-model='firstKilledAtNight', type='text', typeahead='name for name in names | filter:$viewValue', placeholder='Введите имя..')
                    div.row
                        div.col-sm-3
                            span
                                br
                    div.row
                        label.col-sm-3 Первый выведенный игрок:
                        div.col-sm-3
                            input.form-control.player-name(ng-model='firstKilledByDay', type='text', typeahead='name for name in names | filter:$viewValue', placeholder='Введите имя..')
                    div.row
                        div.col-sm-3
                            span
                                br
                    div.row
                        label.col-sm-3 Лучший ход:
                        div.col-sm-3
                            input.form-control.player-name(ng-model='bestMoveAuthor', type='text', typeahead='name for name in names | filter:$viewValue', placeholder='Введите имя..')
                        div.col-sm-2
                            select.form-control(ng-init='possibleValues=[0, 1, 2, 3]', ng-options='possibleValue for possibleValue in possibleValues', ng-model='bestMoveAccuracy')
                    div.row
                            button.btn.btn-success.pull-right(type='submit', ng-disabled="gameResultForm.$invalid") Сохранить
                    div.row
                        script(type='text/ng-template', id='error_box.html')
                            div.modal-header
                                h3.modal-title Ошибка :(
                            div.modal-body
                                ul
                                   li(ng-repeat="msg in msgs")
                                    p {{msg}}
                            div.modal-footer
                                button.btn.btn-primary(ng-click='ok()') Ок
                        script(type='text/ng-template', id='success_box.html')
                            div.modal-header
                                h3.modal-title Получилось!
                            div.modal-body
                                ul
                                   li(ng-repeat="msg in msgs")
                                    p {{msg}}
                            div.modal-footer
                                button.btn.btn-primary(ng-click='refresh()') Ок

                    //div(ng-controller='LogCtrl')
                    //    button(ng-click='$log.log(players[0].name.value)') log
            div.col-sm-2
        include footer